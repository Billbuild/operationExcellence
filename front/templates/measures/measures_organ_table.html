{% extends 'base/ancestor_factory_workshop.html' %}
{% load template_filters %}

<!-- 头文件，主要是 css 文件 -->
{% block head %}
<style>
    .workshop-nav {
        position: fixed;
        top: 0;
        width: 100%;
        background: #fff;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        z-index: 1000;
    }
    .workshop-nav ul {
        display: flex;
        gap: 15px;
        padding: 0.5rem;
        margin: 0;
        list-style: none;
    }
    .workshop-nav a {
        text-decoration: none;
        color: #333;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        transition: 0.3s;
    }
    .workshop-nav a.active {
        background: #2196F3;
        color: white;
    }

    .workshop-section {
        {#padding: 100px 20px 40px;#}
        padding-top: 60px;
        min-height: 100vh;
    }
    .subtitle {
        color: #6c757d;
        font-size: 14px;
    }
</style>
{% endblock %}

<!-- 标题 -->
{% block title %}{% endblock %}

<!-- 内容 -->
{% block content %}
<nav class="workshop-nav">
    <ul>
        {% for ws in workshop_names %}
        <li class="nav-item">
            <a href="#section-{{ forloop.counter }}" class="nav-link {% if forloop.first %}active{% endif %}">
                {{ ws }}
            </a>
        </li>
        {% endfor %}
    </ul>
</nav>
{% for data in workshop_dataset %}
<section id="section-{{ forloop.counter }}" class="workshop-section">
    <div class="text-center pb-1 pt-3 mb-3" style="background-color: white">
        <p class="subtitle">{{ end_date|date:"Y-m-d" }}</p>
        <h4 class="mb-3 text-primary">{{ factory_name }} - {{ data.workshop_name }} 运营情况 </h4>
        <p class="text-muted">介绍当日MTD YTD 同期 上期的运营情况，以便更全面的比较</p>
    </div>
    <div class="row" >
        <div class="col-md-10 offset-md-1">
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th class="text-center"><small><strong>单位名称</strong></small></th>
                        <th class="text-center"><small><strong>运营指标</strong></small></th>
                        <th class="text-center"><small><strong>运营目标</strong></small></th>
                        <th class="text-center"><small><strong>当日发生</strong></small></th>
                        <th class="text-center"><small><strong>MTD</strong></small></th>
                        <th class="text-center"><small><strong>YTD</strong></small></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center"><small>{{ data.workshop_name }}</small></td>
                        <td class="text-center"><small>{{ data.owe_en_name }}</small></td>
                        <td class="text-center"><small>{{ data.owe_target|percentage:2 }}</small></td>
                        <td class="text-center {{ data.owe_color }}"><small>{{ data.owe|percentage:2 }}</small></td>
                        <td class="text-center {{ data.owe_mtd_color }}"><small>{{ data.owe_mtd|percentage:2 }}</small></td>
                        <td class="text-center {{ data.owe_ytd_color }}"><small>{{ data.owe_ytd|percentage:2 }}</small></td>
                    </tr>
                    <tr>
                        <td class="text-center"><small>{{ data.workshop_name }}</small></td>
                        <td class="text-center"><small>{{ data.rft_en_name }}</small></td>
                        <td class="text-center"><small>{{ data.rft_target|percentage:2 }}</small></td>
                        <td class="text-center {{ data.rft_color }}"><small>{{ data.rft|percentage:2 }}</small></td>
                        <td class="text-center {{ data.rft_mtd_color }}"><small>{{ data.rft_mtd|percentage:2 }}</small></td>
                        <td class="text-center {{ data.rft_ytd_color }}"><small>{{ data.rft_ytd|percentage:2 }}</small></td>
                    </tr>
                    <tr>
                        <td class="text-center"><small>{{ data.workshop_name }}</small></td>
                        <td class="text-center"><small>{{ data.final_rework_en_name }}</small></td>
                        <td class="text-center"><small>{{ data.final_rework_target|percentage:2 }}</small></td>
                        <td class="text-center {{ data.final_rework_color }}"><small>{{ data.final_rework|percentage:2 }}</small></td>
                        <td class="text-center {{ data.final_rework_mtd_color }}"><small>{{ data.final_rework_mtd|percentage:2 }}</small></td>
                        <td class="text-center {{ data.final_rework_ytd_color }}"><small>{{ data.final_rework_ytd|percentage:2 }}</small></td>
                    </tr>
                    <tr>
                        <td class="text-center"><small>{{ data.workshop_name }}</small></td>
                        <td class="text-center"><small>{{ data.bts_en_name }}</small></td>
                        <td class="text-center"><small>{{ data.bts_target|percentage:2 }}</small></td>
                        <td class="text-center {{ data.bts_color }}"><small>{{ data.bts|percentage:2 }}</small></td>
                        <td class="text-center {{ data.bts_mtd_color }}"><small>{{ data.bts_mtd|percentage:2 }}</small></td>
                        <td class="text-center {{ data.bts_ytd_color }}"><small>{{ data.bts_ytd|percentage:2 }}</small></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>
{% endfor %}

{% endblock %}

<!-- 右侧侧边栏 控制栏 -->
{% block control-sidebar %}{% endblock %}

<!-- 文件末尾的 JavaScript 文件-->
{% block script %}
<script>
document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        const targetSection = document.querySelector(targetId);

        targetSection.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });

        document.querySelectorAll('.nav-link').forEach(item => item.classList.remove('active'));
        this.classList.add('active')
    });
});

window.addEventListener('scroll', () => {
    const sections = document.querySelectorAll('.workshop-section');
    let currentSection = '';

    sections.forEach(section => {
        const sectionTop = section.offsetTop;
        if (window.scrollY >= sectionTop - 100) {
            currentSection = section.getAttribute('id');
        }
    });

    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.toggle('active', link.getAttribute('href') === `#${currentSection}`)
    })
});

// 加载分页数据
function loadPage(event, page) {
    event.preventDefault();  // 阻止默认跳转
    // 通过参数传递 page
    const url = `?page=${page}`;
    console.log('hello world');

    $.ajax({
        url: url,
        headers: {
            "X-Requested-With": "XMLHttpRequest"  // 标记为 Ajax 请求
        },
        success: function(data) {
            // 替换表格和分页部分
            $("#data-container").html(data);
        },
        error: function() {
            alert("加载数据失败，请重试！");
        }
    });
}
</script>

{% endblock %}